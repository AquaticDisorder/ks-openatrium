<?php
/**
 * @file
 * Code for the OpenAtrium Discussion feature.
 */

include_once 'oa_discussion.features.inc';
include_once 'oa_discussion.theme.inc';

/*
 * Implements hook_ctools_plugin_directory
 */
function oa_discussion_ctools_plugin_directory($owner, $plugin_type) {
  if ($owner == 'ctools' && $plugin_type == 'content_types') {
    return 'plugins/content_types';
  }
}

/**
 * Implements hook_form_alter
 */
function oa_discussion_form_alter(&$form, &$form_state, $form_id) {
  global $user;
  if (strstr($form_id, 'node_form') && (arg(1) == 'add') &&
    (arg(2) == 'oa-discussion-post')) {
    $nid = arg(3);
    // we are in an node/add form
    // Set the Parent field if we have an argument passed to us
    if (!empty($nid)) {
      if (isset($form['oa_parent']) &&
        empty($form['oa_parent'][LANGUAGE_NONE]['#default_value'])) {
        $form['oa_parent'][LANGUAGE_NONE]['#default_value'] = $nid;
      }
    }
  }
}
